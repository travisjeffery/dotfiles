# ~/.tmux.conf - Emacs-friendly tmux configuration

# ============================================================================
# PREFIX KEY
# ============================================================================
# Use C-z instead of C-b (C-b is backward-char in Emacs)
unbind C-b
set -g prefix C-z
bind C-z send-prefix

# ============================================================================
# GENERAL SETTINGS
# ============================================================================
# Enable true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Increase scrollback buffer
set -g history-limit 50000

# No delay for escape key (critical for Emacs)
set -sg escape-time 0

# Enable focus events (useful for Emacs auto-revert)
set -g focus-events on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable mouse support
set -g mouse on

# ============================================================================
# KEY BINDINGS - EMACS STYLE
# ============================================================================
# Use emacs key bindings in tmux command prompt
set -g status-keys emacs

# Use emacs key bindings in copy mode
setw -g mode-keys emacs

# Split panes with more intuitive keys
bind 2 split-window -v -c "#{pane_current_path}"
bind 3 split-window -h -c "#{pane_current_path}"
bind 0 kill-pane
bind 1 kill-pane -a   # Kill all panes except current (like delete-other-windows)

# Window navigation (Emacs buffer-style)
bind b choose-window  # Like switch-to-buffer
bind k kill-window    # Like kill-buffer

# Pane navigation using arrow keys (after prefix)
bind Up select-pane -U
bind Down select-pane -D
bind Left select-pane -L
bind Right select-pane -R

# Pane navigation using Emacs-style keys
bind o select-pane -t :.+  # Like other-window

# Resize panes
bind -r C-Up resize-pane -U 2
bind -r C-Down resize-pane -D 2
bind -r C-Left resize-pane -L 2
bind -r C-Right resize-pane -R 2

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# ============================================================================
# COPY MODE - EMACS STYLE
# ============================================================================
# Enter copy mode
bind [ copy-mode
bind C-y paste-buffer

# In copy mode:
# C-Space to start selection (default)
# M-w to copy selection (default)
# C-g to cancel (default)

# ============================================================================
# APPEARANCE
# ============================================================================
# Status bar
set -g status-position bottom
set -g status-style bg=colour235,fg=colour248

# Left side: session name
set -g status-left-length 30
set -g status-left "#[fg=colour214,bold] #S #[fg=colour248]│ "

# Right side: date and time
set -g status-right-length 50
set -g status-right "#[fg=colour248]│ #[fg=colour214]%Y-%m-%d %H:%M "

# Window status
setw -g window-status-format " #I:#W "
setw -g window-status-current-format "#[fg=colour214,bold] #I:#W "
setw -g window-status-separator ""

# Pane borders
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour214

# Message styling
set -g message-style bg=colour235,fg=colour214

# ============================================================================
# PASS THROUGH KEYS TO EMACS
# ============================================================================
# These ensure common Emacs keys aren't intercepted by tmux
# Most should work by default, but being explicit helps

# Ensure Meta key works properly
set -g xterm-keys on
